- edit ||= false
- collapsed = session[:lead_document].nil? # && @lead.errors.empty?
= subtitle :lead_document, collapsed, t(:documents)
.section
  %small#lead_document_intro{ hidden_if(!collapsed) }
    = t(:intro, t(:lead_documents_small)) unless edit
  #lead_document{ hidden_if(collapsed) }
    %div.contactsContainer
      %div.flex.gap-custom
        %div
          %div
            %label
              Add Document:
          %div
            %input{type: "text", name: "", id: "", class:"customInputsLeads w-custom-laead-form"}
        %div
          %div
            %label
              Document Type
          %div
            %input{type: "text", name: "", id: "", class:"customInputsLeads w-custom-laead-form"}
      %div.mt-2
        %div
          %label
            Add Document:
        %div
          %input{type: "file", name: "documents[file]", id: "documents-file", multiple: true, class:"w-custom-laead-form-street-long"}
        %div.mt-5px
          %button{type: "button", id: "add-document-button", class:"btn btn-primary"} Add Document
    %div.contactsContainer
      %table
        %thead
          %tr.theadLeads
            %th.p-14.theadLeads Document Name
            %th.p-14.theadLeads Document Type
            %th.p-14.theadLeads Document Size
            %th.p-14.theadLeads Actions
        %tbody{id: "document-table"}
          - @documents.each do |document|
            %tr
              %td.p-14= document.file_file_name
              %td.p-14= document.file_content_type
              %td.p-14= number_to_human_size(document.file_file_size)
              %td.p-14
                = link_to "Download", document.file_url, style: 'margin-right: 10px;'
                = link_to "Remove", "#", class: 'remove-document-button', data: { document_id: document.id }, style: 'margin-left: 10px;'

:javascript
  $(document).ready(function() {
    function clearHiddenInputs() {
      $('input[name="documents_to_remove[]"]').remove();
    }

    clearHiddenInputs();

    $('#add-document-button').click(function() {
      var fileInput = $('#documents-file')[0];
      var files = fileInput.files;

      for (var i = 0; i < files.length; i++) {
        var file = files[i];

        var row = $('<tr>');
        row.append($('<td>').text(file.name));
        row.append($('<td>').text(file.type));
        row.append($('<td>').text(formatBytes(file.size)));
        row.append($('<td>').append('<a href="#" class="remove-document-button" style="margin-left: 10px;">Remove</a>'));
        $('#document-table').append(row);

        var hiddenFileInput = $('<input>').attr({
          type: 'file',
          name: 'documents_files[]',
        });

        var dt = new DataTransfer();
        dt.items.add(file);

        hiddenFileInput[0].files = dt.files;

        $('#lead_document').append(hiddenFileInput);
      }

      fileInput.value = '';
    });

    function formatBytes(bytes, decimals = 2) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const dm = decimals < 0 ? 0 : decimals;
      const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
    }

    $(document).on('click', '.remove-document-button', function(event) {
      event.preventDefault();

      var documentId = $(this).data('document-id');

      if ($('input[name="documents_to_remove[]"][value="' + documentId + '"]').length === 0) {
        var hiddenInput = $('<input>').attr({
          type: 'hidden',
          name: 'documents_to_remove[]',
          value: documentId
        });
        $('#lead_document').append(hiddenInput);
      }

      $(this).closest('tr').remove();
    });

  });
